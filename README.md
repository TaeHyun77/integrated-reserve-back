
### 프로젝트 설명
---
티켓 예약 로직에서 좌석 선택 → 예약 → 결제 , 포인트 리워드 지급의 일련의 과정에서 멱등적인 API와 동시성을 다뤄보고 해결해보는 것을 목적으로 한 프로젝트입니다.
멱등성( Idempotency )을 기반으로 예약 및 취소, 리워드 지급 로직에서 API 중복 호출로 인한 오류를 방지했습니다.
동시성 문제가 발생할 수 있는 예약, 예약 취소, 리워드 지급 등의 핵심 로직에 Redis 분산 락 ~~( mutex )~~ Redisson 기반의 분산락을 사용하여 충돌을 방지했습니다.<br>

<p>Front 리포지토리 : https://github.com/TaeHyun77/reserve-project-front.git</p>
<br>

### 시연 영상
---
![Image](https://github.com/user-attachments/assets/04e6af77-44d2-4098-a96e-c605e5922f66)

<br>

### 기술 스택
---
Backend : SpringBoot , Spring Data JPA, Kotlin

Frontend : React, JavaScript

Database/Cache : MySQL, Redis ~~( mutex 분산 락 )~~ ( Redisson 기반 분산 락 구현 )<br><br>

### 동시성 이슈

---

분산 서버 환경에서는 동일한 자원에 동시에 여러 요청이 들어오는 동시성 문제가 발생합니다. 이러한 문제는 단순히 사용자의 빠른 중복 클릭( 따닥 이슈 ) 수준을 넘어, 여러 서버 인스턴스가 동시에 동일한 자원에 접근하거나 변경하려 할 때 발생합니다.

이 경우, 비즈니스 로직 내부에 예외 처리를 해두었더라도 각 서버가 서로 독립적으로 트랜잭션을 수행하면서 모든 요청이 정상 처리되는 것처럼 보이는 현상이 발생할 수 있습니다.
그 결과 좌석이 중복 예약되거나, 리워드가 중복 지급되는 등 데이터 정합성 문제가 발생하게 됩니다.

이번 프로젝트에서는 분산 환경에서의 동시성 문제를 해결하기 위해, Redis 기반의 분산 락을 적용하여 중복 처리 및 정합성 문제를 해결하고자 합니다.<br><br>

**해결 방안**

여러 동시성 제어 방식 중에서 Redis를 활용한 분산 락 방식을 선택했습니다.

Redis는 단일 서버뿐만 아니라 분산 서버 환경에서도 락을 효율적으로 관리할 수 있으며, 동시성 제어를 애플리케이션 레이어에서 수행함으로써 유지보수성과 확장성이 높고, 컨트롤러나 서비스 단에서 빠른 실패 를 유도할 수 있어 리소스 낭비를 최소화할 수 있습니다.<br><br>

기존에는 스핀락 방식의 분산락을 구현하였지만, Redisson 기반 분산 락으로 변경했습니다.

기존 스핀락 방식은 SETNX/SETEX 명령어를 기반으로 하여 개발자가 직접 재시도 및 타임아웃 로직을 구현해야 하고, 요청이 많을수록 락 획득을 위한 지속적인 재시도로 인해 Redis 부하가 커지는 문제가 있었습니다.

하지만, Redisson은 Lock 인터페이스를 지원하여 재시도와 타임아웃을 간편하게 설정할 수 있고, 락을 얻지 못한 경우에도 Pub/Sub 메커니즘을 통해 락 해제 이벤트를 구독하여 Redis에 불필요한 요청을 보내지 않고 효율적으로 락을 관리할 수 있습니다.

무엇보다 여러 좌석에 동시에 락을 걸어야 하는 상황에서, 기존 스핀락 방식은 락 획득 순서가 보장되지 않아 데드락 위험이 존재했습니다.
반면, Redisson은 멀티락 기능을 통해 여러 락을 하나의 논리적 락으로 묶어 원자적으로 처리함으로써 데드락 발생 가능성을 크게 줄일 수 있다는 점에서 변경하였습니다.<br><br>

**왜 DB락을 사용하지 않고 분산락을 사용할까**<br><br>
⇒ 쿼리 실행까지 가야 락이 적용됨 → DB 부하 증가<br><br>
⇒ 트랜잭션 커밋 직전 또는 예외 발생 시점 → 로직이 모두 실행되고 나서야 실패<br><br>


### 분산락 구현과 JMeter 테스트
---

기존 스핀락 방식에서 Redisson을 사용한 분산락 방식으로 변경하였습니다.

Redisson 방식 : https://velog.io/@ayeah77/Lock-%EB%B0%A9%EC%8B%9D-%EB%B3%80%EA%B2%BD-%EB%B0%8F-%ED%85%8C%EC%8A%A4%ED%8A%B8

스핀락 방식 : https://velog.io/@ayeah77/%EB%B6%84%EC%82%B0%EB%9D%BD-%EA%B5%AC%ED%98%84%EA%B3%BC-%ED%85%8C%EC%8A%A4%ED%8A%B8
